# ADR 026: Decorator model for instrumentation instead of inheritance

## Context

In object-oriented programming when two types represent similar concepts with slight differences they often inherit from a common base type.
However, this relation has some performance impact.
In Java, as soon as a base type method is called on one of the inherited types, this results in a virtual call.
Virtual calls require a lookup of the concrete method at runtime.
This is costly in terms of runtime performance.

In GraalWasm both the `WasmFunctionNode` and the `WasmInstrumentableFunctionNode`, needed to support debugging, are a node that represents a function.
Therefore, it would be possible to have a base type that contains the shared functionality of both classes.

## Decision

We will implement the `WasmFunctionNode`  as a child node of the `WasmInstrumentableFunctionNode`.
In this way, no virtual calls are necessary.
Calls are just forwarded by the `WasmInstrumentableFunctionNode`.

## Status

Active

## Consequences

This increases interpreter performance compared to the inheritance version.

This way of implementing this relation might be harder to comprehend because it might not seem logical at first and requires additional knowledge.

## Commit

`5f1c45908ca`

## Artifacts

- [org.graalvm.wasm.nodes.WasmFunctionNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmFunctionNode.java)
- [org.graalvm.wasm.nodes.WasmInstrumentableFunctionNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmInstrumentableFunctionNode.java)
- [org.graalvm.wasm.nodes.WasmRootNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmRootNode.java)

## Relations

- is related to [ADR 025](./adr-025.md)
- is related to [ADR 027](./adr-027.md)