# ADR 014: Using the Frame for locals and the operand stack

## Context

Currently, the operand stack and local variables in GraalWasm are represented by a long array.
This was more efficient than using the `Frame` since the `Frame` performed a lot of complex logic on every access.
This reduced the interpreter performance of GraalWasm.

As of recently the `Frame` was redesigned to be better optimized for interpreter performance.
The `FrameSlot` objects based access to the `Frame` was replaced with simple integer based access.
In addition, the number of default frame slots can no longer grow dynamically during method execution.
This functionality was moved to a separate part of the `Frame` called auxiliary slots.
Furthermore, additional intrinsifications have been added that optimize the performance of accessing the `Frame` even further.

## Decision

We will switch to this new `Frame` implementation for the operand stack and the local variables.

## Status

Active

## Consequences

The performance of the interpreter is probably a little bit slower than the previous implementation.

However, the maintenance effort is reduces, since we no longer have to use a custom array and custom methods for accessing this array.
Furthermore, this is easier to understand for people coming from other Truffle based languages since all Truffle languages use the `Frame` for their local variables. 

## Commit

`1ac5c01a31d`

## Artifacts

- [org.graalvm.wasm.nodes.WasmBlockNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmBlockNode.java)
- [org.graalvm.wasm.nodes.WasmFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmFrame.java)
- [org.graalvm.wasm.nodes.WasmIfFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmIfNode.java)
- [org.graalvm.wasm.nodes.WasmNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmNode.java)
- [org.graalvm.wasm.nodes.WasmRootNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmRootNode.java)
- [org.graalvm.wasm.WasmCodeEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/WasmCodeEntry.java)
- [org.graalvm.wasm.WasmInstantiator](../../src/org.graalvm.wasm/src/org/graalvm/wasm/WasmInstantiator.java)


## Relations

- deprecates [ADR 010](./adr-010.md)
- is extended by [ADR 018](./adr-018.md)
- is related to [ADR 020](./adr-020.md)