# ADR 027: Artificial statement nodes for instruments

## Context

The Truffle framework supports different types of instrumentation.
This includes debugging, profiling, and many more.

Languages can allow support for these operations by implementing certain methods in their nodes.
One of these methods is needed to provide the location of a node in the source code.
However, since WebAssembly only uses a single node to represent an entire function, no nodes are available for individual statements. 
This prevents debuggers from stopping at individual statements, which makes the debugger unusable.

## Decision

We will implement artificial statement nodes that are generated based on the line information provided by the debugging information.

## Status

Active

## Consequences

This allows to present nodes to the Truffle framework for individual statements, although no real nodes exist in GraalWasm.
Furthermore, this keeps performance stable while providing a good debugging experience.

The implementation requires some knowledge about Truffle, which might make it harder to comprehend.

## Commit

`5f1c45908ca`

## Artifacts

- [org.graalvm.wasm.nodes.WasmBaseStatementNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmBaseStatementNode.java)
- [org.graalvm.wasm.nodes.WasmInstrumentableFunctionNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmInstrumentableFunctionNode.java)
- [org.graalvm.wasm.nodes.WasmInstrumentationSupportNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmInstrumentationSupportNode.java)
- [org.graalvm.wasm.nodes.WasmStatementNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmStatementNode.java)

## Relations

- is related to [ADR 025](./adr-025.md)
- is related to [ADR 026](./adr-026.md)