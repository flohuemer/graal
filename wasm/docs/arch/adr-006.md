# ADR 006: JavaScript interop library

## Context

In addition to GraalWasm, the GraalVM provides a multitude of supported languages.
One of them is Graal.js, a JavaScript runtime.

The W3C defines an interface between JavaScript and WebAssembly.
This interface defines the required functions on the WebAssembly side and the required objects and functions on the JavaScript side.

The Truffle framework provides an interop API that can be used to implement the interaction between guest languages.
The API is based around the `TruffleObject` interface which allows to implement different kinds of objects such as array-like objects, map-like objects, or function-like objects.

Alternatively a shared library could be used to establish an interchange format between Graal.js and GraalWasm.

## Decision

We will implement the WebAssembly JavaScript API with the help of the Truffle interop API. 
Modules, instances, tables, ... will implement the `TruffleObject` interface such that they can be passed between WebAssembly and JavaScript.
We will implement a central `WebAssembly` class implementing the `TruffleObject` interface to provide all methods defined by the W3C specification. 

## Status

Active

## Consequences

Implementing interop via the Truffle API is very performant, since Truffle can optimize the call boundaries between the languages.
In addition, it potentially enables interoperability with other languages in the GraalVM ecosystem.

However, having everything in one central class might make the system harder to comprehend and harder to read.

## Commit

`e7d67b4acc5`

## Artifacts

- [org.graalvm.wasm.api.ByteArrayBuffer](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ByteArrayBuffer.java)
- [org.graalvm.wasm.api.Dictionary](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Dictionary.java)
- [org.graalvm.wasm.api.Executable](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Executable.java)
- [org.graalvm.wasm.api.ExecuteInParentContextNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ExecuteInParentContextNode.java)
- [org.graalvm.wasm.api.Global](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Global.java)
- [org.graalvm.wasm.api.GlobalDescriptor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/GlobalDescriptor.java)
- [org.graalvm.wasm.api.ImportExportKind](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ImportExportKind.java)
- [org.graalvm.wasm.api.ImportModule](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ImportModule.java)
- [org.graalvm.wasm.api.Instance](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Instance.java)
- [org.graalvm.wasm.api.Memory](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Memory.java)
- [org.graalvm.wasm.api.MemoryArrayBuffer](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/MemoryArrayBuffer.java)
- [org.graalvm.wasm.api.MemoryDescriptor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/MemoryDescriptor.java)
- [org.graalvm.wasm.api.Module](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Module.java)
- [org.graalvm.wasm.api.ModuleExportDescriptor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ModuleExportDescriptor.java)
- [org.graalvm.wasm.api.ModuleImportDescriptor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ModuleImportDescriptor.java)
- [org.graalvm.wasm.api.ProxyGlobal](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ProxyGlobal.java)
- [org.graalvm.wasm.api.Sequence](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Sequence.java)
- [org.graalvm.wasm.api.Table](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/Table.java)
- [org.graalvm.wasm.api.TableDescriptor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/TableDescriptor.java)
- [org.graalvm.wasm.api.TableKind](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/TableKind.java)
- [org.graalvm.wasm.api.ValueType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/ValueType.java)
- [org.graalvm.wasm.api.WebAssembly](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/WebAssembly.java)
- [org.graalvm.wasm.api.WebAssemblyInstantiatedSource](../../src/org.graalvm.wasm/src/org/graalvm/wasm/api/WebAssemblyInstantiatedSource.java)

## Relations

- is related to [ADR 015](./adr-015.md)

