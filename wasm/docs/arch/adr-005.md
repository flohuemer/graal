# ADR 005: Encoding of constants in int and long arrays

## Context

The WebAssembly bytecode uses Little Endian Base 128 (LEB-128) variable-length value encoding for all of its constant values.
This format uses the first bit of every byte as an indicator value.
If the first bit is a 1, an additional byte belonging to the same value follows.
If the first bit is a 0, the current byte is the last byte of the value.

Reading these values is best implemented via a loop in Java.
However, reading every constant value via a loop during runtime is pretty inefficient.
Arrays on the other hand can be accessed extremely fast in Java.

## Decision

We will extract constant values during parsing and store them in int and long arrays such that they can be efficiently accessed in the interpreter.

## Status

Deprecated

## Consequences

Constant values can be accessed efficiently in the interpreter.
However, this introduces additional memory overhead since every constant is stored twice and small constants are also extended to 32-bit.
Furthermore, pointers into these arrays are required in the bytecode interpreter.
In addition, this approach is harder to extend if the length of values is extended in the future.

## Commit

`179a300ef29`

## Artifacts

- [org.graalvm.wasm.nodes.WasmBlockNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmBlockNode.java)
- [org.graalvm.wasm.BinaryParser](../../src/org.graalvm.wasm/src/org/graalvm/wasm/BinaryParser.java)
- [org.graalvm.wasm.BinaryStreamParser](../../src/org.graalvm.wasm/src/org/graalvm/wasm/BinaryStreamParser.java)

## Relations

- is enabled by [ADR 001](./adr-001.md)
- is deprecated by [ADR 012](./adr-012.md)