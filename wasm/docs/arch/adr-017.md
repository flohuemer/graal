# ADR 017: Extra data format

## Context

The flat bytecode interpreter model requires additional data to represent branch targets and unwind information.
This format should be presented in a compact way.
However, the full range of possible values should be supported.

## Decision

We will implement two formats for the extra data needed in the flat bytecode interpreter model.
A compact format for the usual case and an extended format to support the full range of possible values.
The first value of every entry in the extra data will be used to differentiate the used format.

## Status

Deprecated

## Consequences

The parser becomes more complicated because for every entry it has to be calculated if the compact format is suitable or if the extended format is needed.
This makes the parser harder to comprehend.

However, this decreases the memory footprint of GraalWasm.

## Commit

`b7a0a29873e`

## Artifacts

- [org.graalvm.wasm.constants.ExtraDataOffsets](../../src/org.graalvm.wasm/src/org/graalvm/wasm/constants/ExtraDataOffsets.java)
- [org.graalvm.wasm.nodes.WasmFunctionNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmFunctionNode.java)
- [org.graalvm.wasm.parser.validation.collections.entries.BranchTableEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/BranchTableEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.BranchTarget](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/BranchTarget.java)
- [org.graalvm.wasm.parser.validation.collections.entries.BranchTargetWithStackChange](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/BranchTargetWithStackChange.java)
- [org.graalvm.wasm.parser.validation.collections.entries.CallEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/CallEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.CallTarget](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/CallTarget.java)
- [org.graalvm.wasm.parser.validation.collections.entries.ConditionalBranchEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/ConditionalBranchEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.ElseEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/ElseEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.ExtraDataEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/ExtraDataEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.IfEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/IfEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.IndirectCallEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/IndirectCallEntry.java)
- [org.graalvm.wasm.parser.validation.collections.entries.UnconditionalBranchEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/entries/UnconditionalBranchEntry.java)
- [org.graalvm.wasm.parser.validation.collections.ControlStack](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/ControlStack.java)
- [org.graalvm.wasm.parser.validation.collections.ExtraDataFormatHelper](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/ExtraDataFormatHelper.java)
- [org.graalvm.wasm.parser.validation.collections.ExtraDataList](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/collections/ExtraDataList.java)
- [org.graalvm.wasm.parser.validation.BlockFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/BlockFrame.java)
- [org.graalvm.wasm.parser.validation.ControlFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/ControlFrame.java)
- [org.graalvm.wasm.parser.validation.IfFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/IfFrame.java)
- [org.graalvm.wasm.parser.validation.LoopFrame](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/LoopFrame.java)
- [org.graalvm.wasm.parser.validation.ParserState](../../src/org.graalvm.wasm/src/org/graalvm/wasm/parser/validation/ParserState.java)
- [org.graalvm.wasm.util.ExtraDataAccessor](../../src/org.graalvm.wasm/src/org/graalvm/wasm/util/ExtraDataAccessor.java)
- [org.graalvm.wasm.util.ExtraDataUtil](../../src/org.graalvm.wasm/src/org/graalvm/wasm/util/ExtraDataUtil.java)
- [org.graalvm.wasm.BinaryParser](../../src/org.graalvm.wasm/src/org/graalvm/wasm/BinaryParser.java)
- [org.graalvm.wasm.WasmCodeEntry](../../src/org.graalvm.wasm/src/org/graalvm/wasm/WasmCodeEntry.java)
- [org.graalvm.wasm.test.suites.ExtraDataSuite](../../src/org.graalvm.wasm.test/src/org/graalvm/wasm/test/suites/ExtraDataSuite.java)

## Relations

- is related to [ADR 016](./adr-016.md)
- is deprecated by [ADR 022](./adr-022.md)