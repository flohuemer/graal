# ADR 008: Support for late linking

## Context

The WebAssembly specification defines that resolving imports is done during instantiation with the help of provided external values.
Instantiation checks that the types of the external values correspond with the imports defined in the module.

When a Java application wants to use GraalWasm it needs to access WebAssembly via a `Context` object.
This context object provides an `eval` method that in case of GraalWasm creates an instance based on the given source module. 
However, this `eval` method does not support any way of providing imports to the instance.
In addition, it is not possible to defined several modules when executing GraalWasm via the command line.

## Decision

We will implement late linking.
Linking will happen when an export of one of the instances is accessed.
In this way imports can be dynamically resolved.
Several modules can be provided via the `eval` method of the `Context` and are linked later.

## Status

Active

## Consequences

This allows running several related modules at the same time.
However, this requires imports to be sorted topologically and makes the Linker much more complicated.
This makes it harder to comprehend, extend, and test the Linker.

## Commit

`c397d0eb3d7`

## Artifacts

- [org.graalvm.wasm.Linker](../../src/org.graalvm.wasm/src/org/graalvm/wasm/Linker.java)
- [org.graalvm.wasm.RuntimeState](../../src/org.graalvm.wasm/src/org/graalvm/wasm/RuntimeState.java)
- [org.graalvm.wasm.test.WasmLateLinkingSuite](../../src/org.graalvm.wasm.test/src/org/graalvm/wasm/test/WasmLateLinkingSuite.java)

## Relations

- is enabled by [ADR 001](./adr-001.md)
- is related to [ADR 024](./adr-024.md)