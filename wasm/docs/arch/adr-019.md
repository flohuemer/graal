# ADR 019: Shadow stack

## Context

The multi-value proposal introduces the ability for functions in WebAssembly to return multiple values. 
This is useful for languages with tuples like Python or languages with structs like C that can be decomposed into a single return consisting of multiple values.

Java does not support multiple return values.
Therefore, a way has to be found to implement this feature.

## Decision

We will use a separate array for multiple return values called the shadow stack. 
This array exists once per execution thread and can dynamically grow if needed.

## Status

Active

## Consequences

Multiple return values can be passed between WebAssembly functions without the need to allocate additional collections.
This reduces the pressure on the garbage collector.

In case multiple return values must be passed to another language, the shadow stack must be copied to a collection.

This system might be harder to comprehend than returning a collection.

## Commit

`d366a867997`

## Artifacts

- [org.graalvm.wasm.nodes.WasmFunctionNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmFunctionNode.java)
- [org.graalvm.wasm.nodes.WasmRootNode](../../src/org.graalvm.wasm/src/org/graalvm/wasm/nodes/WasmRootNode.java)
- [org.graalvm.wasm.WasmContext](../../src/org.graalvm.wasm/src/org/graalvm/wasm/WasmContext.java)
- [org.graalvm.wasm.WasmFunctionInstance](../../src/org.graalvm.wasm/src/org/graalvm/wasm/WasmFunctionInstance.java)

## Relations