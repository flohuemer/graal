# ADR 025: Debug information representation

## Context

The DWARF Debug Information Format V4 groups similar types into one entry in the debug format.
There are structure types for struct, classes, and variant types.
All of them can have member fields and member functions.
In addition, classes allow for inheritance.
Furthermore, there is support for enum types, basic types, such as int or boolean, and many more.
In general DWARF can be used to represent the debug information for a multitude of languages including C, C++, Rust, and Fortran.

This information is encoded in a byte format that is split up into abstract entries, such as a struct with 4 field or a function with 3 parameters, and concrete types derived from the abstract ones.
In this way all information can be represented as a tree-like structure for every compilation unit.

This structures requires an internal representation in GraalWasm.
This representation should be as generic and extensible as possible.
It should be easy to add new concepts to existing debug information of languages.
In addition, adding new supported languages should also be easy to do.

The Truffle framework already provides a way of using and interacting with abstract objects.
This splits objects based on their basic "shape".
The framework allows to represent map-like object, array-like object, and function-like object, in addition to the basic types int, float, long, ...

## Decision

We will implement a Truffle-like hierarchy for the internal representation of debug entries.
Every entry can either represent an array-like structure, a structure with members, such as classes or structs, or a basic type, such as int or boolean.
In addition, a differentiation between types (classes, struct, ...) and objects (variables, fields, ...) should be present.
The factory patter will be used to generate the types and objects so individual languages, such as Rust or C++, can provide their representations of structs, strings, ...

## Status

Active

## Consequences

This allows to represent all different kinds of debug information entries.
In addition, the representation needed by the debugging tools, such as the VS Code debugger or Chrome debugger, can be automatically derived without any explicit conversions.
In addition, the representation is easy to extend, since entries just have to specify if they contain members, have an array-like structure, or provide a basic type.

## Commit

`5f1c45908ca`

## Artifacts

- [org.graalvm.wasm.debugging.data.objects.DebugBinding](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugBinding.java)
- [org.graalvm.wasm.debugging.data.objects.DebugConstantObject](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugConstantObject.java)
- [org.graalvm.wasm.debugging.data.objects.DebugLink](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugLink.java)
- [org.graalvm.wasm.debugging.data.objects.DebugMember](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugMember.java)
- [org.graalvm.wasm.debugging.data.objects.DebugParameter](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugParameter.java)
- [org.graalvm.wasm.debugging.data.objects.DebugRelocatableMember](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugRelocatedMember.java)
- [org.graalvm.wasm.debugging.data.objects.DebugScopeValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugScopeValue.java)
- [org.graalvm.wasm.debugging.data.objects.DebugValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugValue.java)
- [org.graalvm.wasm.debugging.data.objects.DebugVariable](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/objects/DebugVariable.java)
- [org.graalvm.wasm.debugging.data.types.DebugArrayType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugArrayType.java)
- [org.graalvm.wasm.debugging.data.types.DebugBaseType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugBaseType.java)
- [org.graalvm.wasm.debugging.data.types.DebugEnumType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugEnumType.java)
- [org.graalvm.wasm.debugging.data.types.DebugInheritance](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugInheritance.java)
- [org.graalvm.wasm.debugging.data.types.DebugPointerToMemberType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugPointerToMemberType.java)
- [org.graalvm.wasm.debugging.data.types.DebugPointerType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugPointerType.java)
- [org.graalvm.wasm.debugging.data.types.DebugStructType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugStructType.java)
- [org.graalvm.wasm.debugging.data.types.DebugSubroutineType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugSubroutineType.java)
- [org.graalvm.wasm.debugging.data.types.DebugTypeDef](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugTypeDef.java)
- [org.graalvm.wasm.debugging.data.types.DebugVariantType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/types/DebugVariantType.java)
- [org.graalvm.wasm.debugging.data.DebugFunction](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/DebugFunction.java)
- [org.graalvm.wasm.debugging.data.DebugObject](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/DebugObject.java)
- [org.graalvm.wasm.debugging.data.DebugObjectFactory](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/DebugObjectFactory.java)
- [org.graalvm.wasm.debugging.data.DebugType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/data/DebugType.java)
- [org.graalvm.wasm.debugging.languages.c.CObjectFactory](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/c/CObjectFactory.java)
- [org.graalvm.wasm.debugging.languages.c.CPointer](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/c/CPointer.java)
- [org.graalvm.wasm.debugging.languages.cpp.CppObjectFactory](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/cpp/CppObjectFactory.java)
- [org.graalvm.wasm.debugging.languages.cpp.CppString](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/cpp/CppString.java)
- [org.graalvm.wasm.debugging.languages.rust.RustArrayType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/rust/RustArrayType.java)
- [org.graalvm.wasm.debugging.languages.rust.RustFunctionType](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/rust/RustFunctionType.java)
- [org.graalvm.wasm.debugging.languages.rust.RustObjectFactory](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/rust/RustObjectFactory.java)
- [org.graalvm.wasm.debugging.languages.rust.RustPointer](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/rust/RustPointer.java)
- [org.graalvm.wasm.debugging.languages.rust.RustString](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/rust/RustString.java)
- [org.graalvm.wasm.debugging.languages.LanguageSupport](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/languages/DebugLanguageSupport.java)
- [org.graalvm.wasm.debugging.representation.DebugArrayDisplayValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/representation/DebugArrayDisplayValue.java)
- [org.graalvm.wasm.debugging.representation.DebugConstantDisplayValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/representation/DebugConstantDisplayValue.java)
- [org.graalvm.wasm.debugging.representation.DebugDisplayValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/representation/DebugDisplayValue.java)
- [org.graalvm.wasm.debugging.representation.DebugObjectDisplayValue](../../src/org.graalvm.wasm/src/org/graalvm/wasm/debugging/representation/DebugObjectDisplayValue.java)

## Relations

- is related to [ADR 026](./adr-026.md)
- is related to [ADR 027](./adr-027.md)